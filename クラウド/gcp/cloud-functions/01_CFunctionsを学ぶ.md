# Cloud Functions を学ぶ

作成日 2019/12/17

## 01. Cloud Functions とは

公式サイト => [https://cloud.google.com/functions/?hl=ja](https://cloud.google.com/functions/?hl=ja)

> イベント駆動型のサーバーレスコンピューティングプラットフォーム

## 02. Cloud Functions の料金

料金ページ => [https://cloud.google.com/functions/pricing-summary/?hl=ja](https://cloud.google.com/functions/pricing-summary/?hl=ja)

### コンピューティングの構成

メモリの容量を指定するだけで、CPU リソースが比例して割り当てられる

| Memory | CPU    | Comment                                        |
| ------ | ------ | ---------------------------------------------- |
| 128MB  | 200MHz | テスト                                         |
| 256MB  | 400MHz | 小規模で単純な関数                             |
| 512MB  | 800MHz | ある程度のリソースを必要とする関数             |
| 1GB    | 1.4GHz | 速度と費用のバランス                           |
| 2GB    | 2.4GHz | 多くのコンピューティング処理を必要とするタスク |

### Cloud Functions には無料枠がある

- 1 か月の無料呼び出し回数 ... 200 万回
- 1 か月の無料コンピューティング時間 ... 最大 100 万秒（278 時間）
- 1 か月の無料下りトラフィック容量 ... 5GB

これを 1 日単位にする（1 ヶ月を 31 日と見積もる）

- 1 日の無料呼び出し回数 ... 6.5 万回
- 1 日の無料コンピューティング時間 ... 3.2 万秒（9 時間）
- 1 日の無料下りトラフィック容量 ... 161MB

### 料金ページに掲載されている料金の例

#### トライアルプロジェクト

- 256MB メモリ(400MHz CPU)のプロビジョニング
- 1 ヶ月あたりの呼び出し 100 万回
- 1 回の呼び出しごとにランタイム 300 ミリ秒
- 課金対象のネットワーク（下り）は使わない

料金計算

- 呼び出し = 1,000,000 < 2,000,000（無料枠）
- GB 秒 = 75,000 < 400,000（無料枠）
- GHz 秒 = 120,000 < 200,000 （無料枠）
- ネットワーキング = 0 < 5（無料枠）
- 合計 \$0.00

GB 秒の求め方\
呼び出し回数 x 使用メモリ in GB x 使用時間 in 秒\
=> 1,000,000 x 0.25 x 0.3 = 75,000

GHz 秒の求め方\
呼び出し回数 x 使用 CPU 速度 in GHz x 使用時間 in 秒\
=> 1,000,000 x 0.4 x 0.3 = 120,000

#### 単純な関数

- 256MB メモリ (400MHz CPU) のプロビジョニング
- 1 ヶ月あたりの呼び出し 1,000 万回
- 1 回の呼び出しごとにランタイム 300 ミリ秒
- 課金対象のネットワーク（下り）は使わない

料金計算

- 呼び出し = 1,0000,000 - 2,000,000 = 8,000,000 x $0.0000004 = $3.20
- GB 秒 = 750,000 - 400,000 = 350,000 x $0.0000025 = $0.88
- GHz 秒 = 1,200,000 - 200,000 = 1,000,000 x $.00001 = $10.00
- ネットワーキング = 0 < 5（無料枠）
- 合計 \$14.08

#### 計算量の大きい関数

- 512MB メモリ（500MHz CPU)のプロビジョニング
- 1 ヶ月あたりの呼び出し 3,000 万回
- 1 回の呼び出しごとにランタイム 500 ミリ秒
- 1 回の呼び出しごとに 5KB のデータを呼び出し元に返す（HTTP 呼び出し）

料金計算

- 呼び出し = 30,0000,000 - 2,000,000 = 28,000,000 x $0.0000004 = $11.20
- GB 秒 = 7,500,000 - 400,000 = 7,100,000 x $0.0000025 = $17.75
- GHz 秒 = 12,000,000 - 200,000 = 1,180,000 x $0.00001 = $118.00
- ネットワーキング = 143.05 - 5 = 138.05 x $0.12 = $16.57
- 合計 \$163.52

ネットワーキングの求め方\
呼び出し回数 x 返しデータ KB / 1024 / 1024\
=> 143.05 GB
