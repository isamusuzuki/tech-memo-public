# SPAアプリを開発する

作成日 2026/01/26、更新日 2026/01/27

## 1. C3を使って新規プロジェクトを作成する

```bash
npm create cloudflare@latest
```

|  No   | 質問                                 | 回答                |
| :---: | ------------------------------------ | ------------------- |
|   1   | install create-cloudlare package OK? | y                   |
|   2   | In which directory?                  | ./simple-todo-spa   |
|   3   | What start with?                     | Framework Starter   |
|   4   | Which framework?                     | React               |
|   5   | Select platform                      | Workers with assets |
|   6   | Select variant                       | TypeScript          |
|   7   | install cresate-vite package OK?     | y                   |
|   8   | use git?                             | No                  |
|   9   | deploy your app?                     | No                  |

```bash
cd simple-todo-spa
npm run dev #=> Open browser to http://localhost:5173/
```

※ 開発コンテナの場合は、vite.config.tsに、`{server: {host: true}}`を追加する

```js
export default defineConfig({
  plugins: [react(), cloudflare()],
  server: { host: true } // 追加する
})
```

今まで7878だったポートが、5173になっている => 開発サーバーは、wranglerからviteに変更になった

package.json

```json
{
    "scripts": {
        // 今まで
        // "dev": "wrangler dev",
        //  "deploy": "wrangler deploy",
        "dev": "vite",             
        "deploy": "npm run build && wrangler deploy"
    }
}
```

- vite ... Reactのコンパイラー＆開発サーバー
- wrangler ... Cloudflareのデプロイツール＆開発サーバー
- `@cloudflare/vite-plugin` ... viteとwranglerを連携させるツール
- 開発サーバーはviteになったが、wranglerも連携しているので、サーバーサイドも動いている

### 作成されたサブフォルダの内容

```text
--simple-todo-spa/
    |--.vscode/
    |   `--settings.json ... VSCode用の設定ファイル
    |--public/           ... 画像置き場1
    |--src/              ... ここに置かれたファイルはViteでコンパイルされる
    |   |--assets/       ... 画像置き場2
    |   |--App.css       
    |   |--App.tsx       ... Reactコンポーネント
    |   |--index.css
    |   |--main.tsx      ... HTMLファイルにリンク、App.tsxを処理
    |   `--vite-env.d.ts ... 型定義ファイル
    |--worker/           ... サーバーサイドの実行ファイル
    |   `--index.ts
    |--eslint.config.js  ... ESLint用の設定ファイル
    |--.gitignore        ... Git用の設定ファイル
    |--index.html        ... SPA用のHTMLファイル
    |--package-lock.json ... npm用の設定ファイル2（見ない、いじらない）
    |--package.json      ... npm用の設定ファイル1（見る、いじる、理解する）
    |--tsconfig.app.json     ... TypeScript用の設定ファイル（SPA）
    |--tsconfig.json         ... TypeScript用の設定ファイル（統合）
    |--tsconfig.node.json    ... TypeScript用の設定ファイル（サーバー1）
    |--tsconfig.worker.json  ... TypeScript用の設定ファイル（サーバー2）
    |--vite.config.ts.       ... Vite用の設定ファイル
    |--worker-configuration.d.ts ... 型定義ファイル
    `--wrangler.jsonc    ... Cloudflare用の設定ファイル
```

## 2. APIサーバーを再現する

- `/simple-todo-api`から、schema.sqlとtest-local.httpをコピペする
- `/simple-todo-api`の`wrangler.jsonc`から、accoount_idとd1_databaseをコピペする

```bash
cd simple-todo-spa

npx wrangler d1 execute todoapi --local --file=./schema.sql
npx wrangler d1 execute todoapi --local --command='SELECT * FROM todos'

# Honoをインストールする
npm install hono
```

`/simple-todo-api`の`src/api.ts`のコードで、`worker/index.ts`を上書きする

```javascript
// .basePath("/api")を追加
const api = new Hono<{ Bindings: Env }>().basePath("/api");
```

`test-local.http`のURLにある7878を5173に変更する

```text
GET http://127.0.0.1:5173/api/todos HTTP/1.1
```

開発サーバーを動かし、`test-local.http`を使ってAPIをテストする

```bash
npm run dev
```

### 生成AIにOpenAPI仕様書を作らせる

`Ctrl + Shift + I`で、Copilotチャット枠を表示する => Agentモード、Autoモデル

`worker/api.ts`、`schema.sql`、`test-local.http`を順番に開き、コマンド枠のプラスボタンをクリックして、ファイルを追加する

以下のコマンドをコピペして、生成AIを実行する

```text
worker/api.tsとschema.sqlとtest-local.httpを参照して、このサーバーのOpenAPI仕様書を作成してください。ファイル名は、openapi.yamlにしてください
```

出来上がったopenapi.yamlファイルを確認する

## 3. Tailwind CSSを導入する

```bash
cd simple-todo-spa

npm i -D tailwindcss @tailwindcss/vite
```

vite.config.tsを編集する

```javascript
import tailwindcss from '@tailwindcss/vite'   // 追加する

export default defineConfig({
  plugins: [
    tailwindcss()      // 追加する
  ]
})
```

src/index.cssを全て書き換える

```css
@import "tailwindcss";
```

src/App.tsxを全て書き換える

```javascript
function App() {
  return (
    <div className='p-2'>
      <h1 className="m-3 text-3xl font-bold underline">Simple Todo</h1>
    </div>
  )
}

export default App
```

第2回で作成したファビコンをpublicフォルダに配置する

index.htmlを編集する

```html
<!--ファビコンを変更-->
<link rel="shortcut icon" href="/favicon.ico">

<!--タイトルを変更-->
<title>Simple Todo</title>
```

開発サーバーを起動して、Webページを確認する

## 4. React Routerを導入する

```bash
cd simple-todo-spa

npm i react-router
```

src/App.tsxをコピペして、src/pages/TopPage.tsxを作る

```javascript
function TopPage() {
  return (
    <div className='p-2'>
      <h1 className="m-3 text-3xl font-bold underline">Simple Todo</h1>
      <p className="m-3">Top Page</p>
    </div>
  )
}

export default TopPage
```

src/pages/TopPage.tsxをコピペして、NewPage.tsx, EditPage.tsxを作る

src/main.tsxを編集する

```javascript
import { BrowserRouter, Route, Routes } from 'react-router'   // 追加する
import App from './App.tsx' // 削除する
import TopPage from './pages/TopPage' // 追加する
import NewPage from './pages/NewPage' // 追加する
import EditPage from './pages/EditPage'  // 追加する

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <BrowserRouter>
      <Routes>
          <Route path="/" element={<TopPage />} />
          <Route path='/new' element={<NewPage />} />
          <Route path='/edit/:id' element={<EditPage />} />
      </Routes>
    </BrowserRouter>
  </StrictMode>,
)
```

開発サーバーを起動して、Webページを確認する

アドレスに`/new`または`/edit/1`を追加すると、Webページが変わることを確認する

## 5. 生成AIに指示書を作成させる

```text
simple-todo-spaフォルダの中を調査して、指示書（Agent Instructions）を日本語で生成してください。
simple-todo-spaフォルダの中に、copilot-instructions.mdファイルを作成してください。
指示書の内容は日本語で書いてください。
```

出来上がったcopilot-instructions.mdファイルを確認する

## 6. 生成AIにSPAアプリを開発させる

spec,mdを作成する

```text
# simple-todo-spaの仕様

## TopPage

- TODOの一覧をテーブルで表示する
- テーブルの列は、「タイトル」「コンテンツ」「操作」の3つ
- テーブルの行は、全てのTODOがIDの降順で並ぶ
- テーブルの「タイトル」列には、TODOのタイトルが表示される
- TODOのタイトルはリンクになっていて、EditPageに飛ぶ
- テーブルの「コンテンツ」列には、TODOのコンテンツが表示される
- テーブルの「操作」列には、削除ボタンが表示される
- 削除ボタンをクリックすると、「本当に削除しますか？」とダイアログが出て、次に進むと、データベースからそのTODOが削除されて、さらにその行も消える
- テーブルの下には、新規ボタンがある。新規ボタンをクリックすると、NewPageに飛ぶ

## NewPage

- 入力フォームを表示する
- タイトルというラベルを持つ`<input type="text">`がある。入力は必須である
- コンテンツというラベルを持つ`<textarea></textarea>`がある。入力は必須である
- 作成ボタンがある。作成ボタンをクリックするとデータベースにTODOが登録されて、TopPageに遷移する

## EditPage

- ページデザインは、NewPageのものを流用する
- データベースの該当するTODOの内容をinputとtextareaにそれぞれ表示して、編集できるようにする
- 更新ボタンがある。更新ボタンをクリックするとデータベースの該当するTODOが更新されて、TopPageに遷移する
```

spec.mdとopenapi.yamlとcopilot-instructions.mdをコンテキストに追加する

```text
spec.mdとopenapi.yamlとcopilot-instructions.mdに従って、simpe-todo-spaを完成させてください
```
