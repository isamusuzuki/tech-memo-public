# SPAアプリを開発する

作成日 2026/01/26

## 1. C3を使って新規プロジェクトを作成する

```bash
npm create cloudflare@latest
```

|  No   | 質問                                 | 回答                |
| :---: | ------------------------------------ | ------------------- |
|   1   | install create-cloudlare package OK? | y                   |
|   2   | In which directory?                  | ./simple-todo-spa   |
|   3   | What start with?                     | Framework Starter   |
|   4   | Which framework?                     | React               |
|   5   | Select platform                      | Workers with assets |
|   6   | Select variant                       | TypeScript          |
|   7   | install cresate-vite package OK?     | y                   |
|   8   | use git?                             | No                  |
|   9   | deploy your app?                     | No                  |

```bash
cd simple-todo-spa
npm run dev #=> Open browser to http://localhost:5173/
```

※ 開発コンテナの場合は、vite.config.tsに、`{server: {host: true}}`を追加する

```js
export default defineConfig({
  plugins: [react(), cloudflare()],
  server: { host: true } // 追加する
})
```

今まで7878だったポートが、5173になっている => 開発サーバーは、wranglerからviteに変更になっている

package.json

```json
{
    "scripts": {
        // 今まで
        // "dev": "wrangler dev",
        //  "deploy": "wrangler deploy",
        "dev": "vite",             
        "deploy": "npm run build && wrangler deploy"
    }
}
```

- vite ... Reactのコンパイラー＆開発サーバー
- wrangler ... Cloudflareのデプロイツール＆開発サーバー
- `@cloudflare/vite-plugin` ... viteとwranglerを連携させるツール

### 作成されたサブフォルダの内容

```text
--simple-todo-spa/
    |--.vscode/
    |   `--settings.json ... VSCode用の設定ファイル
    |--public/           ... 画像置き場1
    |--src/              ... ここに置かれたファイルはViteでコンパイルされる
    |   |--assets/       ... 画像置き場2
    |   |--App.css       
    |   |--App.tsx       ... Reactコンポーネント
    |   |--index.css
    |   |--main.tsx      ... HTMLファイルにリンク、App.tsxを処理
    |   `--vite-env.d.ts ... 型定義ファイル
    |--worker/           ... サーバーサイドの実行ファイル
    |   `--index.ts
    |--eslint.config.js  ... ESLint用の設定ファイル
    |--.gitignore        ... Git用の設定ファイル
    |--index.html        ... SPA用のHTMLファイル
    |--package-lock.json ... npm用の設定ファイル2（見ない、いじらない）
    |--package.json      ... npm用の設定ファイル1（見る、いじる、理解する）
    |--tsconfig.app.json     ... TypeScript用の設定ファイル（SPA）
    |--tsconfig.json         ... TypeScript用の設定ファイル（統合）
    |--tsconfig.node.json    ... TypeScript用の設定ファイル（サーバー1）
    |--tsconfig.worker.json  ... TypeScript用の設定ファイル（サーバー2）
    |--vite.config.ts.       ... Vite用の設定ファイル
    |--worker-configuration.d.ts ... 型定義ファイル
    `--wrangler.jsonc    ... Cloudflare用の設定ファイル
```

## 2. APIサーバーを構築する

- `/simple-todo-api`から、schema.sqlとtest-local.httpをコピペする
- `/simple-todo-api`のwrangler.jsoncから、accoount_idとd1_databaseをコピペする

```bash
cd simple-todo-spa

npx wrangler d1 execute todoapi --local --file=./schema.sql
npx wrangler d1 execute todoapi --local --command='SELECT * FROM todos'

# Honoをインストールする
npm install hono
```

`/simple-todo-api`のsrc/api.tsのコードで、`worker/index.ts`を上書きする

worker/index.ts

```javascript
// .basePath("/api")を追加
const api = new Hono<{ Bindings: Env }>().basePath("/api");
```

test-local.httpのURLにある7878を5173に変更する

test-local.http

```bash
GET http://127.0.0.1:5173/api/todos HTTP/1.1
```

開発サーバーを動かし、test-local.httpをテストする

```bash
npm run dev
```

### 生成AIにOpenAPI仕様書を作らせる

`Ctrl + Shift + I`で、Copilotチャット枠を表示する

Agentモード、Autoモデル

worker/api.ts、schema.sql、test-local.httpを順番に開き、コマンド枠のプラスボタンをクリックして、ファイルを追加し、最後に以下のコマンドをコピペして、実行する

```text
api.tsとschema.sqlとtest-local.httpを参照して、このサーバーのOpenAPI仕様書を作成してください。ファイル名は、openapi.yamlにしてください
```

openapi.yamlが完成する
