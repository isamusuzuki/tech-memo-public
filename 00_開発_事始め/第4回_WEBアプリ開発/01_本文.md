# WEBアプリを開発する

作成日 2026/01/19、更新日 2026/01/25

## 1. 第3回のコードを改造する

- `src/index.ts`ファイルを`src/api.ts`ファイルに改名する
- `app`変数を`api`に全て変更する
- `.basePath("/api")`を取り除く

src/api.ts

```javascript
import { Hono } from "hono";

export interface Env {
    todoapi: D1Database;
}

// appをapiに変更、.basePath("/api")を削除
const api = new Hono<{ Bindings: Env }>();

// 省略

// appをapiに変更
export default api;
```

改めて`src/index.ts`ファイルを作成する

```javascript
import { Hono } from "hono";
import api from "./api";

const app = new Hono();

app.route("/api", api);

export default app;
```

- 開発サーバーを起動して、今までのURLが変わりなく動作していることを確認する
- これで、Honoのファイルを、分離することができた

## 2. JSXを使えるように設定を追加する

tsconfig.json

```json
{
    "compilerOptions": {
        "jsx": "react-jsx",            // 変更なし
        "jsxImportSource": "hono/jsx", // 追加する
    },
    "include": [
        "src/**/*.ts", // 変更なし
        "src/**/*.tsx" // 追加する
    ]
}
```

## 3. ファイルを追加・修正する

src/renderer.tsx

```javascript
import { jsxRenderer } from "hono/jsx-renderer";

export const renderer = jsxRenderer(
    ({ children }) => {
        return (
            <html lang="ja">
                <head>
                    <meta charset="UTF-8" />
                    <meta
                        name="viewport"
                        content="width=device-width, initial-scale=1.0"
                    />
                    <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js"
                        integrity="sha384-/TgkGk7p307TH7EXJDuUlgG3Ce1UVolAOFopFekQkkXihi5u/6OCvVKyz1W+idaz" 
                        crossorigin="anonymous"></script>
                    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
                    <title>Simple Todo</title>
                </head>
                <body>
                    <div className="p-4">
                        <h1 className="text-4xl font-bold mb-4">
                            <a href="/todos">Simple Todo</a>
                        </h1>
                        {children}
                    </div>
                </body>
            </html>
        );
    },
    { docType: "<!DOCTYPE html>" },
);
```

src/page.tsx

```javascript
import { Hono } from "hono";
import { renderer } from "./renderer";

export interface Env {
    todoapi: D1Database;
}

const page = new Hono<{ Bindings: Env }>();

page.get("*", renderer);

page.get("/", async (c) => {
    return c.render(
        <div>
            <h1>Simple Todo API</h1>
            <p>Welcome to the Simple Todo API page.</p>
        </div>,
    );
});

export default page;
```

src/index.tsxを修正する

```javascript
import { Hono } from "hono";
import api from "./api";
import page from "./page"; // 追加する

const app = new Hono();

app.route("/api", api);
app.route("/todos", page); // 追加する

// 追加する
app.get("/", (c) => {
    return c.redirect("/todos");
});

export default app;
```

- 開発サーバーを起動して、ルートURLが`/todos`にリダイレクトされることを確認する
- `c.render()`が、引数として与えられたHTMLタグをJSXRendererに食わせ、合体したHTML文をブラウザにレスポンスしていることを確認する

## 4. Todo全件をテーブルで表示する

type定義を追加する

```javascript
type Todo = {
    id: number;
    title: string;
    content: string;
};
```

`/`ページへのGETメソッドを修正する

```javascript
page.get("/", async (c) => {
    const { results } = await c.env.todoapi
        .prepare("SELECT id, title, content FROM todos ORDER BY id DESC;")
        .all<Todo>();
    const todos = results;
    return c.render(
        <table>
            <thead>
                <tr>
                    <th className="border text-left font-bold px-4 py-2">タイトル</th>
                    <th className="border text-left font-bold px-4 py-2">内容</th>
                </tr>
            </thead>
            <tbody>
            {todos.map((todo) => {
                return (
                    <tr>
                        <td className="border px-4 py-2">{todo.title}</td>
                        <td className="border px-4 py-2">{todo.content}</td>
                    </tr>
                );
            })}
            </tbody>
        </table>
    );
});
```

## 5. 追加ページを作成する

`/new`ページへのGETメソッドを追加する

```javascript
page.get("/new", (c) => {
    return c.render(
        <form action="/todos" method="post">
            <div className="mb-4">
                <label className="block text-gray-700 text-sm font-bold mb-2" for="title">
                    タイトル
                </label>
                <input className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="title" name="title" type="text" placeholder="タイトルを入力してください" required />
            </div>
            <div className="mb-4">
                <label className="block text-gray-700 text-sm font-bold mb-2" for="content">
                    内容
                </label>
                <textarea className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="content" name="content" placeholder="内容を入力してください" required></textarea>
            </div>
            <div>
                <button className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="submit">
                    追加
                </button>
            </div>
        </form>,
    );
});
```

`/`ページへのPOSTメソッドを追加する

```javascript
page.post("/", async (c) => {
    const data = await c.req.formData();
    const title = data.get("title")?.toString() || "（無題）";
    const content = data.get("content")?.toString() || "（内容なし）";
    try {
        await c.env.todoapi
            .prepare("INSERT INTO todos (title, content) VALUES (?, ?)")
            .bind(title, content)
            .run();
        return c.redirect("/");
    } catch (e) {
        return c.render(
            <div className="mt-4 text-red-500">エラーが発生しました。{e}</div>,
        );        
    }
});
```

`/`ページへのGETメソッドを修正して、`/new`ページへのリンクを追加する

```javascript
return c.render(
    <>
    <table>
    </table>
    <div className="mt-4">
        <a href="/todos/new" className="text-white bg-blue-500 hover:bg-blue-700 px-3 py-1 rounded text-sm">新規作成</a>
    </div>
    </>,
);
```

## 6. htmxを試す

`/test`ページへのGETメソッドを追加する

```javascript
page.get('/test', (c) => {
    return c.render(
        <>
        <button hx-post="/todos/test" hx-target="#target" hx-trigger="click" className="rounded-md bg-blue-500 text-white px-4 py-2">クリック</button>
        <p id="target">クリックしたらここが変わります</p>
        </>
    );
});
```

`/test`ページへのPOSTメソッドを追加する

```javascript
page.post('/test', (c) => {
    return c.render(
        <p>ボタンがクリックされました！</p>
    );
});
```

## 7. 削除機能を追加する

- `/`ページへのGETメソッドを修正する
- `<tead><tr>`に、3つ目の`<th>`を追加する
- `<tbody><tr>`に、`hx-`から始まる属性を追加する
- `<tbody><tr>`に、3つ目の`<td>`を追加する

```javascript
return c.render(
    <>
    <table>
        <thead>
            <tr>
                <th className="border text-left font-bold px-4 py-2">タイトル</th>
                <th className="border text-left font-bold px-4 py-2">内容</th>
                <th className="border text-left font-bold px-4 py-2">操作</th>
            </tr>
        </thead>
        <tbody>
        {todos.map((todo) => {
            return (
                <tr hx-confirm="本当に削除しますか？" hx-target="this" hx-swap="outerHTML">
                    <td class="border px-4 py-2">{todo.title}</td>
                    <td class="border px-4 py-2">{todo.content}</td>
                    <td className="border px-4 py-2">
                        <button hx-delete={`/todos/${todo.id}`} className="text-white bg-red-500 hover:bg-red-700 px-3 py-1 rounded text-sm">削除</button>
                    </td>
                </tr>
            );
        })}
        </tbody>
    </table>
    </>
);
```

`/`ページへのDELETEメソッドを追加する

```javascript
page.delete("/:id", async (c) => {
    const id = c.req.param("id");
    await c.env.todoapi.prepare("DELETE FROM todos WHERE id = ?;").bind(id).run();
    c.status(200);
    return c.body(null);
});
```
