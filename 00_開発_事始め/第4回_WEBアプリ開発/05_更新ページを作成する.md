# 更新ページを作成する

作成日 2026/01/25

## 1. `/update/:id`ページへのGETメソッドを追加する

- `/new`ページへのGETメソッドをコピペして改造する
- URLを変更、その中にidを埋め込む
- `c.req.param()`でidを抜き出す
- データベースからidのデータを取得する
- formのaction属性（投稿先）を変更
- inputにvalue属性にデータを追加
- textareaのインナーにデータを追加
- 追加ボタンを更新ボタンに変更

```javascript
page.get("/update/:id", async (c) => {
    const id = c.req.param("id");
    const result = await c.env.todoapi.prepare("SELECT * FROM todos WHERE id = ?").bind(id).first();
    return c.render(
        <form action={`/todos/update/${id}`} method="post">
            <div className="mb-4">
                <label
                    className="block text-gray-700 text-sm font-bold mb-2"
                    for="title"
                >
                    タイトル
                </label>
                <input
                    className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    id="title"
                    name="title"
                    type="text"
                    placeholder="タイトルを入力してください"
                    value={result?.title as string || ""}
                    required
                ></input>
            </div>
            <div className="mb-4">
                <label
                    className="block text-gray-700 text-sm font-bold mb-2"
                    for="content"
                >
                    内容
                </label>
                <textarea
                    className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                    id="content"
                    name="content"
                    placeholder="内容を入力してください"
                    required
                >{result?.content}</textarea>
            </div>
            <div>
                <button
                    className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                    type="submit"
                >
                    更新
                </button>
            </div>
        </form>,
    );
});
```

## 2. `/update/:id`ページへのPOSTメソッドを追加する

- `/`ページへのPOSTメソッドをコピペして改造する
- URLを変更、その中にidを埋め込む
- `c.req.param()`でidを抜き出す
- SQLクエリーをINSERTからUPDATEに変更する

```javascript
page.post("/update/:id", async (c) => {
    const id = c.req.param("id");
    const data = await c.req.formData();
    const title = data.get("title")?.toString() || "（無題）";
    const content = data.get("content")?.toString() || "（内容なし）";
    try {
        await c.env.todoapi
            .prepare("UPDATE todos SET title = ?, content = ? WHERE id = ?")
            .bind(title, content, id)
            .run();
        return c.redirect("/");
    } catch (e) {
        return c.render(
            <div className="mt-4 text-red-500">エラーが発生しました。{e}</div>,
        );
    }
});
```

## 3. `/`ページへのGETメソッドを修正して、`/update/:id`ページへのリンクを追加する

- `<tbody><tr>`の、最初の`<td>`を編集する
- `{todo.title}`をアンカータグで囲む

```javascript
<td className="border px-4 py-2">
    <a href={`/todos/update/${todo.id}`} className="text-blue-500 hover:underline">
        {todo.title}
    </a>
</td>
```
