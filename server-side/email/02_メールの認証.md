# メールの認証

作成日 2019/11/07

## 01. メール認証の種類

インターネット・プロバイダー (ISP) は、メールを受信すると、受信者に配信する前に認証をチェックして、送信元が実際にそのメールアドレスの所有者であることを確認する

- SPF (Sender Policy Framework) ... 送信元のシステムにさかのぼって追跡可能
- DKIM (DomainKeys Identified Mail) ... メッセージに署名して、本人認証と改ざん防止
- DMARC (Domain-based Message Authentication, Reporting and Conformance) ... ポリシーの設定

## 02. SPF (Sender Policy Framework) とは

SPFはメール検証標準であり、メールスプーフィングを防止する

ドメイン所有者は、そのドメインへのメールの送信元として許可するメールサーバーを指定する

ドメイン所有者は、許可されているメールサーバーのリストをDNSレコードとしてドメインのDNSサーバーに発行する

受信側のメールサーバーは、MAIL FROMアドレスにドメインが含まれているメールを受信すると、ドメインのDNSレコードを調べ、送信元メールサーバーとして許可されているメールサーバーのリストと比較し、その結果に従ってメールを処理する

## 03. DKIM (DmainKeys Identified Mail) とは

DKIMは送信者が暗号化キーでメールメッセージを署名できる規格

DKIMを使って送信されるメールメッセージには、`DKIM-Signature`というヘッダーフィールドがあり、メッセージに対し暗号化を用いて署名したデータが格納される

インターネット・プロバイダー (ISP) は、送信者のDNSレコードで発行されるパブリックキーを使用して、署名をデコードする

## 04. DMARC (Domain Message Authentication Reporting & Conformance) とは

DMARCポリシーを指定するTXTレコードを追加する

```=
_dmarc.example.com
TXT
"v=DMARC1;p=quarantine;pct=25;rua=dmarcreports@example.com"
```

- example.com の From ドメインを持ち、SPF または DKIM 認証に合格しないすべてのメールを探す
- 認証に失敗したメールの25%をスパムフォルダに送信して隔離する
- 認証に失敗したすべてのメールに関するレポートをダイジェストで送信する
