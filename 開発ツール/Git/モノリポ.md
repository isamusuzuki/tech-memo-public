# モノリポ

作成日 2025/04/01

モノリポ = モノリス・リポジトリ。たったひとつの巨大なリポジトリ

## 1. モノリポ向けコマンド

参照サイト => [git の sparse-checkout を使ってモノリポでも快適にいこう！](https://tech.asoview.co.jp/entry/2023/03/14/095235)

> 弊社では現在 Git リポジトリをモノリポで運用しています。\
> モノリポ内には数十のパッケージ(モジュール)がありますが、使いたいパッケージは限られるケースが多いです。 あるいは、マイクロサービス環境の場合などで複数のパッケージを異なるブランチで checkout したいという場合もあります。 普通に git clone すると全パッケージのDLが始まりディスク使うし clone に時間がかかるし大変です。 そこで 私は git の sparse-checkout を使って必要なパッケージのみを手元にDLしています。

```bash
git clone --filter=blob:none --no-checkout {git repository url}
cd {repository_name}
git sparse-checkout set path/to/directory1 path/to/directory2
git checkout
```

最終行のチェックアウトは、sparse-checkoutで指定したディレクトリのみチェックアウトされる

### 1a. git clone パラメーター解説

- `--filter=blob:none` ... クローンしてもファイルの中身をダウンロードさせない。`.git`ディレクトリの中身を小さくさせる
- `--no-checkout` ... クローンしてもチェックアウトしない。`.git`ディレクトリのみ作成させる

## 1b. git sparse-checkout オプション解説

- `set` ... sparse-checkoutを有効にする。後続にチェックアウトしたいディレクトリを指定する
- `add` ... ディレクトリを追加する
- `list` ... 現在設定されているディレクトリを確認する

## 2. モノリポのメリット・デメリット

参照サイト2 => [Monorepo開発のメリット vs デメリット](https://circleci.com/ja/blog/monorepo-dev-practices/)

モノレポには次のようなメリットがある

- 見やすい
- コードを共有できる
- コラボレーションがしやすい
- 標準化が容易
- 状況を把握しやすい
- リリースを管理しやすい
- リファクタリングが容易

モノレポにはデメリットもいくつか存在する

- 共通のコードを変更すると、数多くのアプリケーションコンポーネントに影響が及んでしまう
- ソースの競合によりマージしにくい場合もある
- デプロイプロセスが複雑化する可能性があり、ソース管理システムのスケーリングも必要

自動化したCI/CDパイプラインを導入すれば、これまでに述べたモノレポのデメリットはすべて解消できる。\
それぞれの開発チームは、他のチームを邪魔することなく独立してマイクロサービスの開発に取り組み、\
コンテナイメージをビルドしてデプロイできるようになる

モダンなCI/CDツールなら、スケーリングは自動で行われ、複雑なデプロイの管理も簡単。\
モノレポの規模が大きくなっても、マイクロサービスのビルド、テスト、さらにはデプロイまで個別に行える
