# 合計行を追加する

作成日 2025/08/12

```python
# CSVファイルを読み込む
df = pd.read_csv(input_filename1, encoding="utf-8").fillna("")

# 全体のタスクを「機能項目」で集計する
df1_copy = (
    df[["機能項目", "Task ID"]].rename(columns={"Task ID": "全体"}).copy()
)
df1 = df1_copy.groupby("機能項目").count().reset_index()

# 完了しているタスクを抽出して、「機能項目」で集計する
df2_pick = df1[
    (df1["ステータス"] == "完了") | (df1["ステータス"] == "製造完了")
]
df2_copy = (
    df2_pick[["機能項目", "Task ID"]].rename(columns={"Task ID": "完了"}).copy()
)
df2 = df2_copy.groupby("機能項目").count().reset_index()

# 未完了のタスクを抽出して、「機能項目」で集計する
df3_pick = df[df["ステータス"] == ""]
df3_copy = (
    df3_pick[["機能項目", "Task ID"]]
    .rename(columns={"Task ID": "未完了"})
    .copy()
)
df3 = df3_copy.groupby("機能項目").count().reset_index()

# 機能項目と全体・完了・未完了を結合する
df4 = pd.merge(df1, df2, on="機能項目", how="outer").fillna(0)
df5 = pd.merge(df4, df3, on="機能項目", how="outer").fillna(0)
df5["完了"] = df5["完了"].astype(int)
df5["未完了"] = df5["未完了"].astype(int)

# 正しい順番の機能項目のCSVファイルを読み込む
df6 = pd.read_csv(input_filename2, encoding="utf-8")
df7 = pd.merge(df6, df5, on="機能項目", how="outer")
df8 = df7.sort_values("順番")[["機能項目", "全体", "完了", "未完了"]]

# 合計行を追加する
df8.loc[len(df8.index)] = [
    "合計",
    df8["全体"].sum(),
    df8["完了"].sum(),
    df8["未完了"].sum(),
]
```
