# タスクスケジューラに Bash スクリプトを登録する

作成日 2020/11/04

## 01. なぜ Bash スクリプトなのか

Python の仮想環境を有効にしてから、Python スクリプトを実行したいから

PowerShell スクリプトでは、このツーステップをどう実現すればわからなかった

方向転換して、タスクスケジューラで Git Bash を起動して、Bash スクリプトを実行する

登録する Bash スクリプトは、以下のテンプレートを踏襲することとなる

```bash
# 仮想環境の有効化
source venv/Scripts/activate

# 一時的な環境変数の設定
PYTHONPATH=/c/Users/USER-NAME/PROJECT-NAME
export PYTHONPATH

# Pythonスクリプトの実行
python FILE-NAME.py METHOD-NAME >> temp/LOG-NAME.log 2>&1

# 仮想環境の無効化
deactivate

# 環境変数の取り消し
unset PYTHONPATH
```

## 02. タスクスケジューラを起動する

コントロールパネル ＞ 右上の表示方法 ＞ 「小さいアイコン」に変更

管理ツール ＞ 「タスク スケジューラ」をダブルクリック ＞ 「タスク スケジューラ」ウィンドウが登場

## 03. タスクを作成する

右枠 ＞ 操作 ＞ 「タスクの作成...」をクリック（※「基本タスクの作成」ではない）

「タスクの作成」ダイアログが登場

### 全般タブ

名前を入力する ＞ TASK-NAME

セキュリティオプション ＞ 「ユーザーがログオンしているかどうかにかかわらず実行する」を選択

OK ボタンをクリック

### トリガータブ

新規ボタンをクリック ＞ 「新しいトリガー」ダイアログが登場

- 設定: 毎日
- 開始: ※開始したい最初の日付と時刻を入力する
- 間隔: 1 日

OK ボタンをクリック

### 操作タブ

新規ボタンをクリック ＞ 「新しい操作」ダイアログが登場

- プログラム/スクリプト: cmd
- 引数の追加: `/c ""C:\Program Files\Git\bin\bash.exe" --login -i -- C:\Users\USER-NAME\PROJECT-NAME\FILE-NAME.sh"`
- 開始: `C:\Users\USER-NAME\PROJECT-NAME`

参考記事 => [Execute Bash Script \(Using Git Bash\) from Windows Task Scheduler](https://gist.github.com/damc-dev/eb5e1aef001eef78c0f4)

```bash
cmd /c ""C:\Program Files\Git\bin\bash.exe" --login -i -- H:\Daily_Reports\yesterdayTogglReport.sh"
```

OK ボタンをクリック

### パスワードを入力する

タスクの作成ウィンドウの OK ボタンをクリック

ユーザーのログインパスワードを入力する

OK ボタンをクリック

### 作成したタスクを確認する

タスクスケジューラをいったん閉じて、もう一度開く

左枠 ＞ タスク スケジューラ (ローカル) ＞ タスク スケジューラ ライブラリ
