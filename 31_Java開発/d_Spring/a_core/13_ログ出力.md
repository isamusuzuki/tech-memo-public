# ログ出力

作成日 2024/12/24、更新日 2025/12/03

## 1. ログ出力の設定方法

- Spring Bootには、logback とSLF4Jが最初から組み込まれている
- ログ出力の設定は、logbackに対して行う

### いちから自分で設定してみる

`src/main/resources`フォルダに`logback-spring.xml`を作成する

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE logback>
<configuration>
  <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
    <encoder>
      <pattern>%date %level [%thread] %logger %msg%n</pattern>
    </encoder>
  </appender>

  <root level="INFO">
    <appender-ref ref="STDOUT" />
  </root>
</configuration>
```

- これは、「INFOレベルのログを、コンソールに、自分が設定したパターンで、出力させる」という設定
- `logback-spring.xml`を作成すると、Spring Bootのデフォルト設定を上書きしてしまうので、要注意

### Sping Bootのデフォルト設定を継承しつつ、自分の設定を追加する

`src/main/resorce`フォルダに`logback-spring.xml`を作成する

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE logback>
<configuration>
  <!-- Spring Bootのデフォルト設定を読み込む -->
  <include resource="org/springframework/boot/logging/logback/defaults.xml" />
  <include resource="org/springframework/boot/logging/logback/console-appender.xml" />

  <!-- INFOレベルのログをコンソールに出力させる-->
  <root level="INFO">
    <appender-ref ref="CONSOLE"/>
  </root>

  <!-- 自分なりの設定を追加する -->
  <logger name="org.dbflute.system.QLog" level="DEBUG">
    <appender-ref ref="CONSOLE"/>
  </logger>
</configuration>
```

- [defaults.xml の中身](https://github.com/spring-projects/spring-boot/blob/main/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/logback/defaults.xml)
- [console-appender.xml の中身](https://github.com/spring-projects/spring-boot/blob/main/spring-boot-project/spring-boot/src/main/resources/org/springframework/boot/logging/logback/console-appender.xml)
- `console-appender.xml`では`CONSOLE`という名前のアペンダーが定義されてる

## 2. Lombokを使うメリット

参照サイト => [Spring Boot で SLF4J+logback+Lombok を使いログ出力を行う](https://www.aruse.net/entry/2022/07/09/220510#SLF4J-%E3%81%A8%E3%81%AF)

> - SLF4J単体では動作せず、logbackなどのロギングフレームワークが必要になる
> - log4jの開発者が、log4jの後継として開発したのが、logbackとSLF4J
> - SLF4Jとlogbackだけだと、全てのクラスでLoggerの宣言をする必要がある
> - Lombokを使用すると、`@Slf4j`のアノテーションを付けるだけでログを出力できるようになる

```java
@Slf4j
public class LogSampleClass {
  public void log() {
    log.info("infoログを出力しました");
  }
}
```

### Lombokをプロジェクトに追加する

- `pom.xml`を開く
- dependencies タグに以下を追加する

```xml
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
    <optional>true</optional>
</dependency>
```

- Visual Studio Codeが「ビルドファイルが更新された。Javaのクラスパス/設定と同期させたいか？」と尋ねてくるので、イエスと答える

## 3. Javaのログライブラリ

[javaのログライブラリまとめ(slf4j, logback, log4j2)](https://zenn.dev/yyamada12/articles/860701683ada37)

- ログライブラリは、ファサードとログ出力の実装に大別される
- slf4j, log4j2(log4j-api), commons loggingはファサード
- logback, log4j2(log4j-core), log4j, java.util.loggingは実装
- slf4j, log4j2は、他のライブラリ経由で送られてくるログを乗っ取る仕組みを持つ
- 現在は、slf4j+logbackが広く使われている
