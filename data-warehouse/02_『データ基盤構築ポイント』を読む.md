# 『データ基盤を構築する際のポイント』を読む

作成日 2019/12/16

[データ基盤構築をする際におさえておくべき7つのポイント \- Qiita](https://qiita.com/munaita_/items/7b666903a08e6b2543cb)

## 1. 最強だと思う分析用データベースを選ぶ

私はBigQuery信者なので、BigQueryを強くおすすめします

分析用データベースの全体像を掴むには渡部徹太郎さんの資料\
「ビッグデータ処理データベースの全体像と使い分け 2018年version」\
が参考になると思います

[ビッグデータ処理データベースの全体像と使い分け 2018年version](https://www.slideshare.net/tetsutarowatanabe/2018version-115735455)

## 2. ワークフローエンジンでジョブを管理する

データ基盤を作るのであれば、ワークフローエンジンでジョブを管理するようにしましょう。

@elyunim26さんの「2019年のワークフローエンジンまとめ」が大変参考になります。

[2019年のワークフローエンジンまとめ \- Qiita](https://qiita.com/elyunim26/items/15db924e4c9833e5050a)

グロービスではGCPが提供する、Cloud Composer(フルマネージドのAirflowクラスタサービス)を採用しました。

## 3. ステークホルダーとの調整を優先度高くする

データを提供する事業システム側からすると、データ提供は面倒なものです。\
事業システム側に負担にならない形でデータ取得を進めていくようにしましょう。

データ基盤構築で避けて通れないのはデータのセキュリティ管理です。\
セキュリティ周りは、特に慎重に調整する必要があります。

## 4. 権限(IAM)の運用ルールを決める

セキュリティ周りの管理も含め、IAMの運用ルールはきちんと決めておきましょう。\
特に、データ基盤はアクセスする人が増えていくので、運用負荷がかからない方法でルール決めをしましょう。

## 5. 監視設定を忘れずに

データ基盤の障害はユーザーへの影響が直接的ではないので、\
監視が後回しになりがちですが、忘れずにやっていきましょう。

- StackDriver ... ワークフローエンジンのリソース監視、BigQueryのスロット監視
- GCP予算アラート機能 ... プロジェクトの予算監視
- superQuery ... ユーザー/サービスアカウント毎のBigQueryの使用量の監視
- BigQueryのカスタムコスト監視 ... BigQueryに高額クエリを投げられように制御

## 6. メタデータ管理ツールを用意する

[データ利活用を促進するメタデータ](https://www.slideshare.net/techblogyahoo/ss-72253140)

グロービスではメタデータツールとして、GCPのデータカタログを採用しました。

## 7. SQL中心アーキテクチャを意識する

SQL中心アーキテクチャは、以下の3つの条件を満たす分析システムです

1. 必要なデータを1つのデータベースに集める
2. データの加工には原則としてSQLだけを用いる
3. データベース内を論理的にソースデータ層・DWH層・アプリケーション層の3つの層に区分する

- ソースデータ層 ... 元データをそのまま格納した層
- DWH層 ... 整理・統合された汎用共通データモデル層
- アプリケーション層 ... 特定の分析やアプリケーションに特有のデータを格納する層（データマート）


