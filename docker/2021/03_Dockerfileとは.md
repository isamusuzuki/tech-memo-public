# Dockerfile とは

作成日 2021/06/13

[Dockerfile リファレンス](http://docs.docker.jp/engine/reference/builder.html)

> Docker は Dockerfile から命令を読み込み、自動的にイメージを構築できます。\
> Dockerfile はテキスト形式のドキュメントであり、コマンドライン上でイメージを\
> 作り上げる命令を全て記述します。\
> ユーザは docker build を使い、複数のコマンド行の命令を順次実行し、\
> イメージを自動構築します。

## Dockerfile の EXPOSE 命令と docker コマンドの`-p`フラグは、どう使い分けるのか

- EXPOSE 命令はコンテナがそのポートをリッスンすることを Docker に伝える
- EXPOSE 命令だけあっても、これだけではホストからコンテナにアクセスできない
- ホストからコンテナにアクセスするには、`-p`フラグを使ってポート転送を設定する必要がある

### Dockerfile の VOLUME 命令と docker コマンドの`-v`フラグは、どう使い分けるのか

- VOLUME 命令は、マウントポイントを作成し、外部マウント可能なボリュームにする
- `-v`フラグはコンテナにデータボリュームを追加する
- `-v`フラグは、ホスト上にあるディレクトリもコンテナにマウント可能
- VOLUME 命令は、ホスト上にあるディレクトリをコンテナにマウントすることはできない

`-v`フラグの使い方

- `-v /webapp` ... webapp という新しいボリュームを作成する
- `-v /opt/webapp:ro` ... 読み込み専用でボリュームをマウントする
- `-v /src/webapp:/opt/webapp` ... ホスト側のディレクトリをコンテナにマウントする

### 自分が考える Dockerfile の役割

Dockerfile の役割は、Docker イメージの構築である\
構築されたイメージはポータブルでないといけない。どこでも使えないといけない\
Docker ホストに依存するホストディレクトリのマウントを、\
Dockerfile で指示することはできない\
必要なファイルはイメージの中にコピーするのが王道
