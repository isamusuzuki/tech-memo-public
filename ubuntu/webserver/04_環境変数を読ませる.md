# 環境変数を読ませる

作成日 2020/09/10

## gunicorn を systemdのサービスにする

以下のファイルを書く

/etc/systemd/system/bobby.service

```text
[Unit]
Description=Gunicorn instance to serve bobby
After=network.target

[Service]
User=ubuntu
Group=www-data
WorkingDirectory=/home/ubuntu/bobby
Environment="PATH=/home/ubuntu/bobby/bin"
ExecStart=/home/ubuntu/bobby/bin/gunicorn --workers 3 --bind unix:bobby.sock -m 007 wsgi:app

[Install]
WantedBy=multi-user.target
```

起動する

```bash
sudo systemctl start bobby
sudo systemctl enable bobby
sudo systemctl status bobby
```

## 環境変数を読まない問題が発生

wsgi.py で `load_dotenv()` しているから大丈夫かと思っていたが\
そもそも `python wsgi.py` を実行しているわけではないので、\
`__main__` パートは呼ばれていないと考えるべき

```python
from dotenv import load_dotenv

from server import app


if __name__ == "__main__":
    load_dotenv()
    app.run()
```

## 環境変数を読ませるには

Service ファイルを書き換えればよい

```text
[Service]
EnvironmentFile=/home/ubuntu/bobby/.env
```
