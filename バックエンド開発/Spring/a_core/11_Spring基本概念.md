# Spring の基本概念

作成日 2024/12/27、更新日 2025/01/16

参照書籍 => P.38 "第 3 章 DI という考え方" from 「プロになるための Spring 入門」

## 1. DI コンテナ

DI = Dependency Injection 日本語では「依存性注入」 デザインパターンのひとつ

デザインパターンとは、ソフトウェア開発で皆がよく使っている、「大きな形」「型」「仕組み」のこと

### DI の例

- データベースにアクセスしてデータを取得し、少し編集してから、画面に表示させたい
- 業務ロジック（少し編集の）のコード（クラス）を、`Service`と名付ける
- 実際にデータベースにアクセスしてデータを取得するコード（クラス）を、`Repository`と名付ける
- `Service`クラスは、データ取得については`Respository`クラスに依存（お任せ）させる
- テスト専用の（別の）`Respository`クラスを`Service`クラスに注入すれば、1 行も改変せずに本物のデータベースを使わずにテストができる
- ただしこのパターンでは、`Respository`クラスを`Service`クラスに適切に注入する、大きな存在が必要。それをコンテナと呼ぶ

## 2. Spring 用語の解説

| Key        | Value                                                            |
| ---------- | ---------------------------------------------------------------- |
| Controller | リクエストを受け取り、Service を呼びだし、適切な View を呼び出す |
| View       | 動的なデータを埋め込み、HTML を作成する                          |
| Entity     | 業務データを保持する                                             |
| Input      | ユーザーが入力した情報を保持する                                 |

| Key                    | Value                             |
| ---------------------- | --------------------------------- |
| Bean                   | DI コンテナが管理するオブジェクト |
| Bean 定義              | Bean を定義する情報               |
| コンフィグレーション   | DI コンテナに読ませる情報         |
| Application Controller | DI コンテナの別名                 |

## Bean 定義の手段 3 つ

1. ステレオタイプアノテーション(※)をつける
1. `@Bean`メソッド。戻り値のオブジェクトが Bean になる。外部ライブラリのクラスを Bean 定義するときに利用
1. XML 内の`<Bean>`タグ。今は使わない。XML 地獄と言われた昔の主流

※ Bean として Spring に管理してほしい具象クラスにつけるアノテーションのこと

### ステレオタイプアノテーションの種類

| Key              | Value                                                                |
| ---------------- | -------------------------------------------------------------------- |
| `@Service`       | 付加機能なし                                                         |
| `@Repository`    | DB アクセス周りの例外を Spring の例外に送る                          |
| `@Controller`    | SpringMVC の機能を使う                                               |
| `@Component`     | 付加機能なし                                                         |
| `@Autowired`     | インジェクションを指示するアノテーション                             |
| `@ComponentScan` | パッケージ名を指定。ステレオタイプアノテーションがついたクラスを探す |
| `@Configuration` | JavaConfig クラスのアノテーション                                    |

### インジェクションの手段 3 つ

1. コンストラクションインジェクション。コンストラクターの引数にする
1. Setter インジェクション。Setter メソッドを用意する
1. フィールドインジェクション。`@Autowired`をつけたフィールドを定義するだけ
